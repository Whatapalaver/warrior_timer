<div
  class="min-h-screen flex flex-col transition-colors duration-500 bg-slate-900 text-white"
  data-controller="timer workout-storage share"
  data-timer-segments-value="<%= segments_json %>"
  data-timer-audio-outlet="#audio-controller"
  data-workout-storage-intervals-value="<%= @intervals_param %>"
  data-share-code-value="<%= @intervals_param %>"
>
  <!-- Audio controller -->
  <div id="audio-controller" data-controller="audio"></div>

  <!-- Top Navigation Bar (hidden when running) -->
  <div data-timer-target="navButtons" class="w-full lg:pr-80 bg-slate-900 border-b-2 border-slate-700 transition-opacity duration-300">
    <div class="px-4 py-3 flex justify-between items-center">
      <%= link_to root_path, class: "inline-block px-4 py-2 bg-slate-800 text-white border-2 border-slate-700 hover:bg-slate-700 hover:border-slate-600 rounded-lg text-sm font-semibold transition-colors" do %>
        â† Home
      <% end %>

      <div class="flex gap-2">
        <button
          data-workout-storage-target="favoriteButton"
          data-action="click->workout-storage#showFavoriteModal"
          class="px-4 py-2 bg-slate-800 text-slate-400 border-2 border-slate-700 hover:bg-slate-700 hover:border-slate-600 rounded-lg text-sm font-semibold transition-colors"
          title="Add to favorites"
        >
          <span data-workout-storage-target="favoriteIcon">â˜†</span> Favorite
        </button>

        <button
          data-action="click->share#showModal"
          class="px-4 py-2 bg-slate-800 text-white border-2 border-slate-700 hover:bg-slate-700 hover:border-slate-600 rounded-lg text-sm font-semibold transition-colors"
        >
          ğŸ”— Share
        </button>

        <%= render BuyMeCoffee::BuyMeCoffeeComponent.new(style: :nav) %>
      </div>
    </div>
  </div>

  <div class="flex-1 flex items-center justify-center lg:pr-80 overflow-hidden">
    <div class="w-full max-w-4xl px-4 py-8 overflow-x-hidden">
      <!-- Current segment type -->
      <div class="text-center mb-8">
        <h1
          class="text-5xl md:text-6xl lg:text-8xl font-bold uppercase tracking-wider"
          data-timer-target="segmentType"
        >
          Ready
        </h1>
      </div>

      <!-- Main countdown -->
      <div class="text-center mb-8">
        <div
          class="text-7xl md:text-9xl lg:text-[12rem] font-bold tabular-nums"
          data-timer-target="countdown"
        >
          00:00
        </div>
      </div>

      <!-- Round info -->
      <div
        class="text-center mb-8 text-xl md:text-2xl lg:text-3xl text-white font-semibold"
        data-timer-target="roundInfo"
      >
      </div>

      <!-- Controls -->
      <%= render Timer::ControlsComponent.new(intervals_param: @intervals_param) %>

      <!-- Progress -->
      <div class="mt-8 text-center">
        <p class="text-lg text-white font-semibold" data-timer-target="progress">
          Segment 0 of <%= @segments.length %>
        </p>
      </div>

      <!-- Mobile Progress Bar (visible only on mobile and when running) -->
      <div data-timer-target="mobileProgress" class="lg:hidden mt-8 hidden">
        <div class="bg-slate-900 rounded-lg p-4 border-2 border-slate-600">
          <div class="flex justify-between items-center mb-3 text-sm font-semibold">
            <span class="text-white">Progress</span>
            <span data-timer-target="timeRemaining" class="font-mono text-emerald-400">--:--</span>
          </div>

          <!-- Visual progress bar -->
          <div class="relative h-4 bg-slate-800 rounded-full overflow-hidden mb-4 border border-slate-600">
            <div
              data-timer-target="progressBar"
              class="absolute left-0 top-0 h-full bg-gradient-to-r from-emerald-400 to-emerald-500 transition-all duration-300 shadow-lg shadow-emerald-500/50"
              style="width: 0%"
            ></div>
          </div>

          <!-- Compact segment list -->
          <div class="space-y-1.5 max-h-40 overflow-y-auto px-1">
            <% @segments.each_with_index do |segment, index| %>
              <div
                class="flex items-center gap-2 text-xs p-2 rounded <%= mobile_segment_color_class(segment[:segment_type]) %> opacity-60 border-2 border-transparent"
                data-timer-target="mobileSegment"
                data-segment-index="<%= index %>"
              >
                <span class="flex-1 font-bold"><%= segment_label(segment) %></span>
                <span class="font-mono font-semibold"><%= format_time(segment[:duration_seconds]) %></span>
              </div>
            <% end %>
          </div>

          <div class="mt-4 pt-3 border-t-2 border-slate-600 flex justify-between text-sm font-semibold">
            <span class="text-white">Total Time:</span>
            <span class="font-mono text-emerald-400"><%= format_time(@segments.sum { |s| s[:duration_seconds] }) %></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Workout Overview Sidebar (desktop only) -->
  <%= render Workout::OverviewComponent.new(segments: @segments) %>

  <!-- Favorite Modal -->
  <div
    data-workout-storage-target="modal"
    class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    data-action="click->workout-storage#closeModalOnBackdrop"
  >
    <div class="bg-slate-800 rounded-lg p-6 max-w-md w-full" data-workout-storage-target="modalContent">
      <h3 class="text-xl font-bold mb-4 text-white">Add to Favorites</h3>

      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2 text-slate-300">Workout Name (optional)</label>
        <input
          type="text"
          data-workout-storage-target="nameInput"
          data-action="keydown->workout-storage#preventPropagation"
          placeholder="e.g., Morning HIIT, Leg Day"
          class="w-full px-4 py-2 bg-slate-700 text-white rounded-lg border-2 border-slate-600 focus:border-amber-500 focus:outline-none"
        />
        <p class="text-xs text-slate-400 mt-1">Leave blank to auto-detect workout type</p>
      </div>

      <div class="flex gap-3">
        <button
          data-action="click->workout-storage#confirmFavorite"
          class="flex-1 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold rounded-lg transition-colors"
        >
          Save Favorite
        </button>
        <button
          data-action="click->workout-storage#closeModal"
          class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-lg transition-colors"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div
    data-share-target="modal"
    class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    data-action="click->share#closeModalOnBackdrop"
  >
    <div class="bg-slate-800 rounded-lg p-6 max-w-2xl w-full" data-share-target="modalContent">
      <h3 class="text-xl font-bold mb-4 text-white">Share This Timer</h3>

      <!-- Direct Link -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2 text-slate-300">Direct Link</label>
        <div class="flex gap-2">
          <input
            type="text"
            data-share-target="directLink"
            readonly
            class="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg border-2 border-slate-600 font-mono text-sm"
          />
          <button
            data-action="click->share#copyDirectLink"
            class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg transition-colors whitespace-nowrap"
          >
            ğŸ“‹ Copy
          </button>
        </div>
      </div>

      <!-- Embed Code -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2 text-slate-300">Embed Code (iframe)</label>
        <div class="flex gap-2">
          <textarea
            data-share-target="embedCode"
            readonly
            rows="3"
            class="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg border-2 border-slate-600 font-mono text-xs resize-none"
          ></textarea>
          <button
            data-action="click->share#copyEmbedCode"
            class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg transition-colors whitespace-nowrap self-start"
          >
            ğŸ“‹ Copy
          </button>
        </div>
        <p class="text-xs text-slate-400 mt-2">Use this code to embed the timer on your website</p>
      </div>

      <!-- Embed Preview Link -->
      <div class="mb-6">
        <a
          data-share-target="embedPreview"
          href="#"
          target="_blank"
          class="text-sm text-amber-400 hover:text-amber-300 transition-colors"
        >
          Preview embed â†’
        </a>
      </div>

      <div class="flex justify-end">
        <button
          data-action="click->share#closeModal"
          class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-lg transition-colors"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
